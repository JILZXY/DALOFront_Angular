<section class="filtros-busqueda">
  <div class="filtros-container">
    
    <!-- Filtro de Materia/Especialidad -->
    <div class="filtro-dropdown">
      <button class="filtro-btn" 
              [class.active]="materiaDropdownAbierto"
              (click)="toggleDropdown('materia')">
        {{ getNombreEspecialidad(especialidadActiva) }}
        <span class="dropdown-arrow">‚ñº</span>
      </button>
      <div class="dropdown-content" [class.show]="materiaDropdownAbierto">
        <label (click)="limpiarMateria()">
          <input type="radio" 
                 name="especialidad" 
                 [checked]="especialidadActiva === null">
          Todas las Materias
        </label>
        <label *ngFor="let materia of materias" 
               (click)="seleccionarEspecialidad(materia.id)">
          <input type="radio" 
                 name="especialidad" 
                 [checked]="especialidadActiva === materia.id">
          {{ materia.nombreMateria }}
        </label>
      </div>
    </div>

    <!-- Filtro de Estado -->
    <div class="filtro-dropdown">
      <button class="filtro-btn" 
              [class.active]="estadoDropdownAbierto"
              (click)="toggleDropdown('estado')">
        {{ getNombreEstado(estadoActivo) }}
        <span class="dropdown-arrow">‚ñº</span>
      </button>
      <div class="dropdown-content" [class.show]="estadoDropdownAbierto">
        <label *ngFor="let estado of estados" 
               (click)="seleccionarEstado(estado.id)">
          <input type="radio" 
                 name="estado" 
                 [checked]="estadoActivo === estado.id">
          {{ estado.nombre }}
        </label>
      </div>
    </div>

    <!-- Filtro de Ciudad/Municipio -->
    <div class="filtro-dropdown">
      <button class="filtro-btn" 
              [class.active]="ciudadDropdownAbierto"
              [disabled]="!estadoActivo"
              (click)="toggleDropdown('ciudad')">
        {{ getNombreMunicipio(municipioActivo) }}
        <span class="dropdown-arrow">‚ñº</span>
      </button>
      <div class="dropdown-content" [class.show]="ciudadDropdownAbierto">
        <label *ngFor="let municipio of municipiosFiltrados" 
               (click)="seleccionarMunicipio(municipio.id)">
          <input type="radio" 
                 name="municipio" 
                 [checked]="municipioActivo === municipio.id">
          {{ municipio.nombre }}
        </label>
        <div *ngIf="municipiosFiltrados.length === 0" class="no-options">
          Primero selecciona un estado
        </div>
      </div>
    </div>

    <!-- Bot√≥n Limpiar Filtros -->
    <button class="filtro-btn btn-limpiar" 
            (click)="limpiarFiltros()"
            [disabled]="!especialidadActiva && !estadoActivo && !municipioActivo">
      Limpiar Filtros
    </button>
  </div>
</section>

<!-- Loading -->
<div class="loading-container" *ngIf="isLoading">
  <div class="spinner"></div>
  <p>Cargando consultas...</p>
</div>

<!-- Error -->
<div class="error-container" *ngIf="errorMensaje">
  <p>{{ errorMensaje }}</p>
  <button class="btn-retry" (click)="cargarConsultas()">Reintentar</button>
</div>

<!-- Contenedor de Consultas -->
<div class="contenedor" *ngIf="!isLoading && !errorMensaje">
  
  <!-- Contador de resultados -->
  <div class="resultados-info" *ngIf="consultas.length > 0">
    <p>{{ consultas.length }} consulta(s) encontrada(s)</p>
  </div>

  <!-- Cards de Consultas -->
  <div class="card-wrapper" *ngFor="let consulta of consultas">
    <div class="card">
      <div class="card-header">
        <span class="materia-badge">{{ getMateriaConsulta(consulta) }}</span>
        <span class="fecha-badge">{{ formatTime(consulta.fechaPublicacion) }}</span>
      </div>
      
      <div class="card-body">
        <h3 class="card-title">{{ consulta.titulo }}</h3>
        <p class="card-description">{{ consulta.pregunta }}</p>
      </div>
      
      <div class="card-footer">
        <div class="user-info">
          <span class="user-icon">üë§</span>
          <span class="user-name">Usuario An√≥nimo</span>
          <span class="location-info" *ngIf="getMunicipioConsulta(consulta)">
            üìç {{ getMunicipioConsulta(consulta) }}
          </span>
        </div>
        <button class="btn-responder" (click)="verDetalle(consulta.idConsulta)">
          Responder
        </button>
      </div>
    </div>
  </div>

  <!-- Sin resultados -->
  <div class="no-results" *ngIf="consultas.length === 0">
    <div class="no-results-icon">üîç</div>
    <h3>No se encontraron consultas</h3>
    <p>No hay consultas que coincidan con los filtros seleccionados.</p>
    <button class="btn-limpiar-filtros" (click)="limpiarFiltros()">
      Ver todas las consultas
    </button>
  </div>

</div>