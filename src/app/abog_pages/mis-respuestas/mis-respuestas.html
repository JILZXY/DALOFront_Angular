<div class="container">
  
  <div class="loading-container" *ngIf="isLoading">
    <p>Cargando tu historial...</p>
  </div>

  <div class="timeline" *ngIf="!isLoading">
    
    <div class="timeline-item" *ngFor="let item of respuestas">
      <div class="timeline-marker"></div>
      
      <div class="card">
        <div class="card-header">
          <span class="status-badge" [class.calificada]="item.calificacion" [class.pendiente]="!item.calificacion">
            {{ item.calificacion ? 'Calificada' : 'Pendiente' }}
          </span>
          <span class="date">{{ formatTime(item.fechaRespuesta) }}</span>
        </div>

        <div class="pregunta-contexto">
          <h4>{{ item.preguntaTitulo }}</h4>
          <p>"{{ item.preguntaDescripcion }}"</p>
          <div class="usuario-tag">
            <small>Usuario Anónimo</small>
          </div>
        </div>

        <div class="respuesta-content">
          <div class="mi-respuesta-label">Tu Respuesta:</div>
          <p>{{ item.contenidoRespuesta }}</p>
        </div>

        <div class="card-actions">
          <button class="btn-ver" (click)="verCalificacion(item)">
            {{ item.calificacion ? 'Ver Calificación' : 'Ver Estado' }}
          </button>
        </div>
      </div>
    </div>

    <div class="no-results" *ngIf="respuestas.length === 0">
      <p>Aún no has respondido ninguna consulta.</p>
    </div>

  </div>
</div>

<div class="modal-overlay" *ngIf="mostrarModal" (click)="cerrarModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="cerrarModal()">&times;</button>

    <div *ngIf="modalTipo === 'con-calificacion' && calificacionSeleccionada" class="modal-body">
      <h3>¡Te han calificado!</h3>
      
      <div class="score-circle">
        <span class="score-num">{{ calificacionSeleccionada.promedio | number:'1.1-1' }}</span>
        <div class="stars-row">
          <span *ngFor="let s of getEstrellas(calificacionSeleccionada.promedio)" [class.gold]="s !== '☆'">{{ s }}</span>
        </div>
      </div>

      <div class="metrics-grid">
        <div class="metric">
          <span>Profesionalismo</span>
          <div class="bar-bg"><div class="bar-fill" [style.width.%]="(calificacionSeleccionada.profesionalismo / 5) * 100"></div></div>
          <strong>{{ calificacionSeleccionada.profesionalismo }}</strong>
        </div>
        <div class="metric">
          <span>Atención</span>
          <div class="bar-bg"><div class="bar-fill" [style.width.%]="(calificacionSeleccionada.atencion / 5) * 100"></div></div>
          <strong>{{ calificacionSeleccionada.atencion }}</strong>
        </div>
        <div class="metric">
          <span>Claridad</span>
          <div class="bar-bg"><div class="bar-fill" [style.width.%]="(calificacionSeleccionada.claridad / 5) * 100"></div></div>
          <strong>{{ calificacionSeleccionada.claridad }}</strong>
        </div>
        <div class="metric">
          <span>Empatía</span>
          <div class="bar-bg"><div class="bar-fill" [style.width.%]="(calificacionSeleccionada.empatia / 5) * 100"></div></div>
          <strong>{{ calificacionSeleccionada.empatia }}</strong>
        </div>
      </div>
    </div>

    <div *ngIf="modalTipo === 'sin-calificacion'" class="modal-body pending-state">
      <div class="icon-pending">⏳</div>
      <h3>Esperando Calificación</h3>
      <p>El usuario ha visto tu respuesta pero aún no ha dejado una reseña.</p>
      <p class="tip">Consejo: Las respuestas rápidas y amables suelen recibir mejores puntuaciones.</p>
    </div>

  </div>
</div>