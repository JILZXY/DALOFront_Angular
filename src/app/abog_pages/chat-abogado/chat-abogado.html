<div class="chat-container">
  <header class="top-header">
    <div class="menu-icon">
      <a routerLink="/abogado/home" style="color: white; text-decoration: none;">&larr;</a>
    </div>
    <div class="user-info-header">
      <div class="user-name-header">Mis Chats (Abogado)</div>
    </div>
  </header>

  <div class="chat-layout">
    <aside class="contacts-sidebar">
      <div class="search-bar">
        <input type="text" placeholder="Buscar..." class="search-input" [(ngModel)]="terminoBusqueda" />
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="8" stroke="white" stroke-width="2" />
          <path d="m21 21-4.35-4.35" stroke="white" stroke-width="2" stroke-linecap="round" />
        </svg>
      </div>

      <div class="contacts-list">
        <div *ngFor="let chat of getChatsFiltrados(chats$ | async)" class="contact-item"
          [class.active]="(chatActual$ | async)?.id === chat.id" (click)="seleccionarChat(chat)">
          <div class="contact-avatar">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="8" r="4" fill="#223240" />
              <path d="M6 21c0-3.314 2.686-6 6-6s6 2.686 6 6" stroke="#223240" stroke-width="2"
                stroke-linecap="round" />
            </svg>
          </div>
          <div class="contact-info">
            <div class="contact-name">{{ getNombreContacto(chat) }}</div>
            <div class="contact-role">{{ getRolContacto(chat) }}</div>
          </div>
          <div class="contact-meta">
            <div class="contact-date" *ngIf="chat.ultimoMensaje">{{ getHora(chat.ultimoMensaje.fecha) }}</div>
          </div>
        </div>

        <div *ngIf="(chats$ | async)?.length === 0" class="no-items"
          style="padding: 20px; text-align: center; color: #666;">
          No tienes chats activos.
        </div>
      </div>
    </aside>

    <main class="chat-main" *ngIf="(chatActual$ | async) as chat">
      <div class="chat-header">
        <div class="chat-contact-avatar">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="8" r="4" fill="#223240" />
            <path d="M6 21c0-3.314 2.686-6 6-6s6 2.686 6 6" stroke="#223240" stroke-width="2" stroke-linecap="round" />
          </svg>
        </div>
        <div class="chat-contact-info">
          <div class="chat-contact-name">{{ getNombreContacto(chat) }}</div>
          <div class="chat-contact-role">{{ getRolContacto(chat) }}</div>
        </div>
      </div>

      <div class="chat-messages">
        <div *ngFor="let mensaje of mensajes$ | async" class="message-wrapper">
          <div class="message-row" [class.sent]="mensaje.remitenteId === chat.usuarioAbogadoId" [class.received]="mensaje.remitenteId !== chat.usuarioAbogadoId">
            <div class="message-bubble" [class.sent-bubble]="mensaje.remitenteId === chat.usuarioAbogadoId" [class.received-bubble]="mensaje.remitenteId !== chat.usuarioAbogadoId">
              {{ mensaje.mensaje }}
            </div>
            <div class="message-time">{{ getHora(mensaje.fecha) }}</div>
          </div>
        </div>
      </div>

      <div class="message-input-container">
        <button class="attach-button">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5v14M5 12h14" stroke="white" stroke-width="2" stroke-linecap="round" />
          </svg>
        </button>
        <input type="text" class="message-input" placeholder="Escribe tu mensaje" [(ngModel)]="mensajeNuevo"
          (keyup.enter)="enviarMensaje()" />
        <button class="send-button" (click)="enviarMensaje()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 12l14-7-7 14-2-8-8-2z" fill="white" />
          </svg>
        </button>
      </div>
    </main>

    <main class="chat-main empty-state" *ngIf="!(chatActual$ | async)">
      <div class="empty-message">
        <p>Selecciona un contacto para comenzar a chatear</p>
      </div>
    </main>
  </div>
</div>