<div class="chat-container">
  <!-- Header Superior -->
  <header class="top-header">
    <div class="menu-icon">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="3" y="3" width="6" height="6" fill="white"/>
        <rect x="3" y="9" width="6" height="6" fill="white"/>
        <rect x="3" y="15" width="6" height="6" fill="white"/>
        <rect x="9" y="3" width="6" height="6" fill="white"/>
        <rect x="9" y="9" width="6" height="6" fill="white"/>
        <rect x="9" y="15" width="6" height="6" fill="white"/>
        <rect x="15" y="3" width="6" height="6" fill="white"/>
        <rect x="15" y="9" width="6" height="6" fill="white"/>
        <rect x="15" y="15" width="6" height="6" fill="white"/>
      </svg>
    </div>
    <div class="user-info-header">
      <div class="user-name-header">{{ usuarioActual.nombre }}</div>
      <div class="user-type-header">{{ usuarioActual.tipo }}</div>
    </div>
  </header>

  <div class="chat-layout">
    <!-- Sidebar de Contactos -->
    <aside class="contacts-sidebar">
      <!-- Barra de Búsqueda -->
      <div class="search-bar">
        <input 
          type="text" 
          placeholder="Buscar..." 
          class="search-input"
          [(ngModel)]="terminoBusqueda"
        />
        <svg class="search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="8" stroke="white" stroke-width="2"/>
          <path d="m21 21-4.35-4.35" stroke="white" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </div>

      <!-- Lista de Contactos -->
      <div class="contacts-list">
        <div 
          *ngFor="let contacto of getContactosFiltrados()" 
          class="contact-item"
          [class.active]="contactoSeleccionado?.id === contacto.id"
          (click)="seleccionarContacto(contacto)"
        >
          <div class="contact-avatar">
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="12" cy="8" r="4" fill="#223240"/>
              <path d="M6 21c0-3.314 2.686-6 6-6s6 2.686 6 6" stroke="#223240" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="contact-info">
            <div class="contact-name">{{ contacto.nombre }}</div>
            <div class="contact-role">{{ contacto.rol }}</div>
          </div>
          <div class="contact-meta">
            <div class="contact-date" *ngIf="contacto.ultimaFecha">{{ contacto.ultimaFecha }}</div>
            <div class="unread-badge" *ngIf="contacto.mensajesNoLeidos > 0">
              {{ contacto.mensajesNoLeidos }}
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Área Principal de Chat -->
    <main class="chat-main" *ngIf="contactoSeleccionado">
      <!-- Header del Chat -->
      <div class="chat-header">
        <div class="chat-contact-avatar">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="8" r="4" fill="#223240"/>
            <path d="M6 21c0-3.314 2.686-6 6-6s6 2.686 6 6" stroke="#223240" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <div class="chat-contact-info">
          <div class="chat-contact-name">{{ contactoSeleccionado.nombre }}</div>
          <div class="chat-contact-role">{{ contactoSeleccionado.rol }}</div>
        </div>
      </div>

      <!-- Mensajes -->
      <div class="chat-messages">
        <div 
          *ngFor="let mensaje of contactoSeleccionado.mensajes" 
          class="message-wrapper"
          [class.sent]="mensaje.esEnviado"
          [class.received]="!mensaje.esEnviado"
        >
          <div class="message-bubble" [class.sent-bubble]="mensaje.esEnviado" [class.received-bubble]="!mensaje.esEnviado">
            {{ mensaje.contenido }}
          </div>
          <div class="message-time">{{ mensaje.fecha }}</div>
        </div>
      </div>

      <!-- Input de Mensaje -->
      <div class="message-input-container">
        <button class="attach-button">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 5v14M5 12h14" stroke="white" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
        <input 
          type="text" 
          class="message-input"
          placeholder="Escribe tu mensaje"
          [(ngModel)]="mensajeNuevo"
          (keyup.enter)="enviarMensaje()"
        />
        <button class="send-button" (click)="enviarMensaje()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M5 12l14-7-7 14-2-8-8-2z" fill="white"/>
          </svg>
        </button>
      </div>
    </main>

    <!-- Estado vacío cuando no hay contacto seleccionado -->
    <main class="chat-main empty-state" *ngIf="!contactoSeleccionado">
      <div class="empty-message">
        <p>Selecciona un contacto para comenzar a chatear</p>
      </div>
    </main>
  </div>
</div>

