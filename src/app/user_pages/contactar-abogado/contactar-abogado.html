<section class="filtros-busqueda">
  <div class="filtros-container">

    <div class="filtro-dropdown">
      <button class="filtro-btn" id="materiaBtn" (click)="toggleDropdown('materia')"
        [class.active]="materiaDropdownAbierto">
        MATERIA
        <span class="dropdown-arrow">▼</span>
      </button>
      <div class="dropdown-content" id="materiaDropdown" [class.show]="materiaDropdownAbierto">
        <label>
          <input type="radio" name="materia" value="penal" [checked]="materiaActiva === 1"
            (change)="filtrarPorMateria($event)"> Derecho Penal
        </label>
        <label>
          <input type="radio" name="materia" value="civil" [checked]="materiaActiva === 2"
            (change)="filtrarPorMateria($event)"> Derecho Civil
        </label>
        <label>
          <input type="radio" name="materia" value="procesal" [checked]="materiaActiva === 3"
            (change)="filtrarPorMateria($event)"> Derecho Procesal
        </label>
        <label>
          <input type="radio" name="materia" value="laboral" [checked]="materiaActiva === 4"
            (change)="filtrarPorMateria($event)"> Derecho Laboral
        </label>
        <label>
          <input type="radio" name="materia" value="mercantil" [checked]="materiaActiva === 5"
            (change)="filtrarPorMateria($event)"> Derecho Mercantil
        </label>
        <label>
          <input type="radio" name="materia" value="constitucional" [checked]="materiaActiva === 6"
            (change)="filtrarPorMateria($event)"> Derecho Constitucional
        </label>
        <label>
          <input type="radio" name="materia" value="general" [checked]="materiaActiva === 7"
            (change)="filtrarPorMateria($event)"> General
        </label>
      </div>
    </div>

    <div class="filtro-dropdown">
      <button class="filtro-btn" id="estadoBtn" (click)="toggleDropdown('estado')"
        [class.active]="estadoDropdownAbierto">
        ESTADO
        <span class="dropdown-arrow">▼</span>
      </button>
      <div class="dropdown-content" id="estadoDropdown" [class.show]="estadoDropdownAbierto">
        <label *ngFor="let estado of estados">
          <input type="radio" name="estado" [value]="estado.id" [checked]="estadoActivo === estado.id"
            (change)="filtrarPorEstado($event)"> {{ estado.nombre }}
        </label>
        <div *ngIf="estados.length === 0" class="no-items">Cargando estados...</div>
      </div>
    </div>

    <div class="filtro-dropdown">
      <button class="filtro-btn" id="ciudadBtn" (click)="toggleDropdown('ciudad')"
        [class.active]="ciudadDropdownAbierto">
        CIUDAD
        <span class="dropdown-arrow">▼</span>
      </button>
      <div class="dropdown-content" id="ciudadDropdown" [class.show]="ciudadDropdownAbierto">
        <label *ngFor="let municipio of municipios">
          <input type="radio" name="ciudad" [value]="municipio.id" [checked]="ciudadActiva === municipio.id"
            (change)="filtrarPorCiudad($event)"> {{ municipio.nombre }}
        </label>
        <div *ngIf="!estadoActivo" class="no-items">Selecciona un estado primero</div>
        <div *ngIf="estadoActivo && municipios.length === 0" class="no-items">Cargando municipios...</div>
      </div>
    </div>

    <button class="filtro-btn" id="limpiarFiltrosAbogadosBtn" (click)="limpiarFiltros()">
      Limpiar Filtros
    </button>

    <div class="filtro-busqueda">
      <div class="buscador-container">
        <input type="text" class="buscador-input" placeholder="Busca tu abogado" id="buscadorInput"
          [(ngModel)]="terminoBusqueda" (keyup.enter)="buscarPorNombre()">
        <button class="buscar-btn" id="buscarBtn" (click)="buscarPorNombre()">
          <img src="/Images/logo azul.png" alt="Buscar" class="buscar-icon">
        </button>
      </div>
    </div>
  </div>
</section>

<!-- Profile Modal -->
<div class="modal-overlay" *ngIf="isPerfilModalOpen && selectedAbogado" (click)="cerrarPerfil()">
  <div class="modal-content profile-modal" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="cerrarPerfil()">&times;</button>

    <div class="profile-header">
      <div class="profile-info">
        <h2>{{ selectedAbogado.usuario?.nombre }}</h2>
        <span class="profile-cedula">Cédula: {{ selectedAbogado.cedulaProfesional }}</span>
        <div class="profile-rating">
          <span class="star-icon">⭐</span>
          <span class="rating-value">{{ (selectedAbogado.calificacionPromedio || 0).toFixed(1) }}</span>
          <span class="rating-label">Calificación Promedio</span>
        </div>
      </div>
    </div>

    <div class="profile-body">

      <div class="profile-section">
        <h3>Biografía</h3>
        <p>{{ selectedAbogado.biografia || 'Sin biografía disponible.' }}</p>
      </div>

      <div class="profile-section">
        <h3>Ubicación</h3>
        <p>{{ selectedAbogado.usuario?.municipio?.nombre }}, {{ selectedAbogado.usuario?.municipio?.estado?.nombre }}
        </p>
      </div>

      <div class="profile-section">
        <h3>Especialidades</h3>
        <div class="tags-container">
          <span *ngFor="let esp of selectedAbogado.especialidades" class="especialidad-tag">{{ esp.nombreMateria
            }}</span>
        </div>
        <div *ngIf="!selectedAbogado.especialidades || selectedAbogado.especialidades.length === 0" class="no-tags">
          Sin especialidades
        </div>
      </div>

      <div class="profile-actions">
        <button class="btn-contactar-modal" (click)="contactarAbogado(selectedAbogado); cerrarPerfil()">
          Contactar Ahora
        </button>
      </div>
    </div>
  </div>
</div>

<section class="lista-abogados">

  <div *ngIf="isLoading" class="estado-container">
    Cargando abogados...
  </div>

  <div *ngIf="!isLoading && errorMensaje" class="estado-container error">
    {{ errorMensaje }}
  </div>

  <div id="abogadosContainer" *ngIf="!isLoading && abogados.length > 0">

    <div class="abogado-card" *ngFor="let abogado of abogados">
      <div class="abogado-card-inner">
        <div class="abogado-content">

          <div class="abogado-info">
            <div class="abogado-detalles">
              <h3 class="abogado-nombre">{{ abogado.usuario?.nombre }}</h3>
              <p class="abogado-ubicacion">{{ abogado.usuario?.municipio?.nombre || 'Ubicación no disponible' }}, {{
                abogado.usuario?.municipio?.estado?.nombre || '' }}</p>

              <div class="calificacion-container">
                <span class="calificacion-label">Calificación General:</span>
                <span class="calificacion-numero">{{ (abogado.calificacionPromedio || 0).toFixed(1) }}</span>
              </div>
            </div>
          </div>

          <div class="abogado-especialidades">
            <h4>Especialidades:</h4>
            <div class="tags-container">
              <span *ngFor="let esp of abogado.especialidades" class="especialidad-tag">{{ esp.nombreMateria }}</span>
            </div>
            <div *ngIf="!abogado.especialidades || abogado.especialidades.length === 0" class="no-tags">
              Sin especialidades registradas
            </div>
          </div>

          <div class="abogado-acciones">
            <button class="btn-perfil" (click)="verPerfil(abogado)">Ver Perfil</button>
            <button class="btn-contactar" (click)="contactarAbogado(abogado)">Contactar</button>
          </div>

        </div>
      </div>
    </div>

  </div>
</section>